# 考试系统测试指南

## 功能概述

已成功实现以下功能：

### 1. 1122-A.html 修改
- ✅ 删除了温馨书架和游戏角落模块
- ✅ 重新调整了页面布局（2列网格变为居中布局）
- ✅ 在页面底部添加了"前往卧室"按钮
- ✅ 实现了权限检查逻辑（登录状态和卧室权限）

### 2. 520房间页面 (520.html)
- ✅ 创建了完整的520房间页面
- ✅ 实现了权限管理（客栈主人权限）
- ✅ 实现了题目管理功能（新增题目、设置考试）
- ✅ 实现了考试功能（参加考试、评分、权限授予）

### 3. 后端API支持
- ✅ 创建了权限相关数据库表
- ✅ 实现了考试相关的API路由
- ✅ 更新了主服务器文件

### 4. 主页更新
- ✅ 添加了520房间的导航支持

## 测试步骤

### 1. 数据库设置
```sql
-- 运行数据库迁移脚本
mysql -u root -p < backend/config/migrate_permissions.sql
```

### 2. 启动后端服务
```bash
cd backend
npm install
npm start
```

### 3. 功能测试

#### 3.1 基础功能测试
1. 打开 `index.html`
2. 输入房间号 `520` 进入520房间
3. 验证页面正常显示

#### 3.2 权限测试
1. 以普通用户身份登录
2. 进入520房间，应该只能看到"参加考试"按钮
3. 以管理员身份登录（需要先通过考试获得权限）
4. 进入520房间，应该能看到"新增题目"和"设置考试"按钮

#### 3.3 考试功能测试
1. 点击"开始考试"
2. 完成考试题目
3. 提交答案
4. 查看考试结果和权限授予情况

#### 3.4 题目管理测试（需要管理员权限）
1. 点击"新增题目"
2. 填写题目内容和选项
3. 保存题目
4. 点击"设置考试"
5. 配置考试规则

#### 3.5 卧室权限测试
1. 在1122-A.html页面
2. 点击"前往卧室"按钮
3. 验证权限检查逻辑

## 数据库表结构

### user_permissions 表
- 存储用户权限信息
- 支持"前往1122卧室"和"客栈主人"权限

### exam_questions 表
- 存储考试题目
- 包含题目内容、4个选项、正确答案

### exam_settings 表
- 存储考试设置
- 包含题目数量、权限分数要求

### exam_records 表
- 存储考试记录
- 包含用户答案、分数、时间

## API接口

### 权限相关
- `GET /api/users/:id/permissions` - 获取用户权限

### 题目管理
- `POST /api/exam/questions` - 新增题目（需要管理员权限）
- `GET /api/exam/questions` - 获取题目列表（需要管理员权限）

### 考试设置
- `POST /api/exam/settings` - 设置考试规则（需要管理员权限）
- `GET /api/exam/settings` - 获取考试设置

### 考试功能
- `POST /api/exam/start` - 开始考试
- `POST /api/exam/submit` - 提交考试答案
- `GET /api/exam/records` - 获取考试记录

## 注意事项

1. 确保数据库连接正常
2. 确保JWT密钥配置正确
3. 首次使用需要先添加题目才能进行考试
4. 权限授予基于考试分数，需要达到设定分数才能获得相应权限
