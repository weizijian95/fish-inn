# 520房间功能说明

## 功能概述

520房间是一个特殊的测试房间，用户可以通过参加"爱的测试"来获得特殊权限。这个房间实现了完整的考试系统，包括题目管理、权限授予等功能。

## 主要功能

### 1. 权限系统
- **前往1122卧室权限**：通过考试获得，可以访问卧室功能
- **客栈主人权限**：通过考试获得，可以管理题目和设置考试规则

### 2. 题目管理（需要客栈主人权限）
- 新增题目：可以添加新的测试题目
- 设置考试：配置考试规则和权限分数要求

### 3. 考试功能
- 参加考试：所有已登录用户都可以参加考试
- 自动评分：系统自动计算分数并授予相应权限
- 结果展示：显示详细的正误情况和正确答案

## 使用流程

### 普通用户流程
1. 登录系统
2. 在主页输入房间号 `520` 进入520房间
3. 点击"开始考试"参加测试
4. 完成所有题目并提交
5. 查看考试结果，如果达到分数要求会自动获得权限

### 管理员流程
1. 先通过考试获得"客栈主人"权限
2. 进入520房间后可以看到管理功能
3. 点击"新增题目"添加测试题目
4. 点击"设置考试"配置考试规则

## 技术实现

### 前端
- 使用Tailwind CSS构建响应式界面
- 粉红色主题，符合520房间的浪漫氛围
- 模态框实现题目管理和设置功能
- 动态生成考试界面和结果展示

### 后端
- Express.js提供RESTful API
- JWT token进行身份验证
- MySQL数据库存储题目、权限、考试记录
- 权限中间件控制功能访问

### 数据库设计
- `user_permissions`：用户权限表
- `exam_questions`：考试题目表
- `exam_settings`：考试设置表
- `exam_records`：考试记录表

## 权限授予规则

### 默认设置
- 每场考试5道题目
- 答对4题获得"前往1122卧室"权限
- 答对5题获得"客栈主人"权限

### 自定义设置
管理员可以通过"设置考试"功能修改：
- 题目数量（1-20题）
- 卧室权限所需分数
- 管理员权限所需分数

## 安全考虑

1. **权限验证**：所有管理功能都需要相应的权限
2. **身份验证**：使用JWT token确保用户身份
3. **数据验证**：所有输入都进行严格验证
4. **权限隔离**：用户只能访问自己的数据

## 扩展功能

### 已实现
- 完整的考试系统
- 权限管理
- 题目管理
- 考试记录

### 可扩展
- 题目分类
- 难度等级
- 考试时间限制
- 排行榜功能
- 证书生成

## 注意事项

1. 首次使用需要先添加题目
2. 权限授予基于考试分数
3. 考试记录会永久保存
4. 权限一旦获得不会丢失（除非手动删除）

## 文件结构

```
520.html                    # 520房间主页面
backend/routes/exam.js      # 考试相关API
backend/config/migrate_permissions.sql  # 数据库迁移脚本
backend/config/init_test_data.sql       # 测试数据
```

## 部署说明

1. 运行数据库迁移脚本
2. 启动后端服务
3. 在主页输入520进入房间
4. 开始使用考试系统
