# 用户系统功能说明

## 更新内容

已成功实现用户注册、登录和修改头像功能。

## 主要功能

### 1. 用户注册
- 需要提供：用户名、密码、昵称、头像
- 用户名必须唯一
- 密码简单存储（按要求不加密）

### 2. 用户登录
- 使用用户名和密码登录
- 登录信息保存在浏览器本地存储中

### 3. 修改头像
- 登录后点击设置按钮（齿轮图标）
- 可以从6种头像中选择
- 修改后会更新所有相关显示

### 4. 留言板权限
- **必须登录才能发表留言**（按要求实现）
- 可以查看所有留言（不需要登录）
- 只能删除自己的留言

### 5. 其他页面
- 其他页面（如客厅等）不需要登录即可访问（按要求实现）

## 数据库更新

### 新安装
如果是新安装，直接运行 `backend/config/init.sql` 即可。

### 已有数据库迁移
如果数据库已存在，需要运行迁移脚本：

```bash
# 在 backend/config 目录下运行
mysql -u root -p fish_db < migrate_users.sql
```

或者手动执行 SQL：

```sql
USE fish_db;

ALTER TABLE users 
ADD COLUMN username VARCHAR(50) UNIQUE AFTER id;

ALTER TABLE users 
ADD COLUMN password VARCHAR(255) AFTER username;

ALTER TABLE users 
ADD INDEX idx_username (username);
```

## API接口

### 用户相关接口

1. **注册** `POST /api/users/register`
   - 请求体：`{ username, password, nickname, avatar }`
   - 返回：`{ success: true, user: {...} }`

2. **登录** `POST /api/users/login`
   - 请求体：`{ username, password }`
   - 返回：`{ success: true, user: {...} }`

3. **修改头像** `PUT /api/users/:id/avatar`
   - 请求体：`{ avatar }`
   - 返回：`{ success: true, user: {...} }`

4. **修改昵称** `PUT /api/users/:id/nickname`
   - 请求体：`{ nickname }`
   - 返回：`{ success: true, user: {...} }`

5. **获取用户信息** `GET /api/users/:id`
   - 返回：`{ success: true, user: {...} }`

6. **快速注册**（无需用户名密码）`POST /api/users/quick-register`
   - 请求体：`{ nickname, avatar }`
   - 返回：`{ success: true, user: {...} }`
   - 注：此接口保留用于临时用户，但前端不再使用

## 使用流程

1. 用户访问留言板页面
2. 如果未登录，右上角显示"登录"和"注册"按钮
3. 点击"注册"填写信息创建账号
4. 或点击"登录"使用已有账号登录
5. 登录后显示用户昵称和头像
6. 点击齿轮图标可以修改头像
7. 点击退出图标可以登出

## 技术实现

- **前端**：纯HTML + Tailwind CSS + JavaScript
- **后端**：Node.js + Express + MySQL
- **认证**：基于 localStorage 的简单会话管理
- **密码**：明文存储（按要求不需要安全性）

## 注意事项

1. 密码未加密，仅用于演示，不适合生产环境
2. 用户会话保存在浏览器本地，清除浏览器数据会退出登录
3. 已有的无用户名密码的用户记录仍可正常使用（向后兼容）

## 记住，真正的 HTTPS 配置在 /etc/nginx/nginx.conf 中！