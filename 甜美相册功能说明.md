# 甜美相册功能说明

## 功能概述

"甜美相册"是一个照片分享功能，允许已登录用户上传照片并给照片命名。用户可以：

- ✅ 上传照片并给照片起名字
- ✅ 查看所有用户上传的照片
- ✅ 查看照片的上传时间和上传者信息
- ✅ 删除自己上传的照片
- ✅ 点击照片查看大图

## 部署步骤

### 1. 数据库迁移

在部署之前，需要先执行数据库迁移来创建照片表：

```bash
# 连接到 MySQL 数据库
mysql -u root -p

# 执行迁移脚本
source backend/config/migrate_photos.sql;

# 退出
exit;
```

或者直接在命令行执行：

```bash
mysql -u root -p fish_db < backend/config/migrate_photos.sql
```

### 2. 创建照片上传目录

确保照片上传目录存在并有正确的权限：

```bash
mkdir -p backend/uploads/photos
chmod 755 backend/uploads/photos
```

### 3. 重启后端服务

```bash
cd backend
npm install  # 确保所有依赖已安装
node server.js
```

或者如果使用 PM2：

```bash
pm2 restart fish-backend
```

## 使用说明

### 访问相册

1. 访问客厅页面：`1122-A.html`
2. 点击"甜美相册"卡片
3. 进入相册页面

### 登录流程

- **未登录用户**：
  1. 访问相册时会看到登录提示
  2. 点击"去登录"按钮会跳转到登录页面
  3. 登录或注册成功后，自动返回相册页面
  4. 可以继续上传照片

- **已登录用户**：
  1. 直接看到上传区域
  2. 可以立即开始上传照片

### 上传照片

1. 确保已登录（未登录用户只能查看，不能上传）
2. 在上传区域输入照片名称
3. 选择要上传的照片文件
4. 点击"上传照片"按钮

### 查看照片

- 相册会以网格形式展示所有照片
- 每张照片显示：
  - 照片缩略图
  - 照片名称
  - 上传者昵称和头像
  - 上传时间
- 点击照片可以查看大图

### 删除照片

- 只能删除自己上传的照片
- 在自己的照片卡片下方会显示"删除照片"按钮
- 点击按钮确认后即可删除

## 技术细节

### 数据库结构

照片表 (`photos`) 包含以下字段：

- `id`: 照片 ID（主键）
- `user_id`: 用户 ID（外键）
- `nickname`: 上传者昵称
- `avatar`: 上传者头像
- `name`: 照片名称
- `photo_url`: 照片文件路径
- `created_at`: 上传时间
- `updated_at`: 更新时间

### API 接口

#### 1. 上传照片
- **请求**: `POST /api/photos/upload`
- **认证**: 需要 Bearer Token
- **参数**: 
  - `photo`: 照片文件（FormData）
  - `name`: 照片名称
- **响应**: 返回照片信息

#### 2. 获取所有照片
- **请求**: `GET /api/photos`
- **认证**: 不需要
- **响应**: 返回照片列表

#### 3. 获取单张照片
- **请求**: `GET /api/photos/:id`
- **认证**: 不需要
- **响应**: 返回照片详情

#### 4. 删除照片
- **请求**: `DELETE /api/photos/:id`
- **认证**: 需要 Bearer Token
- **权限**: 只能删除自己的照片
- **响应**: 返回删除结果

### 文件存储

- 照片文件存储在 `backend/uploads/photos/` 目录下
- 文件命名格式：`photo-{timestamp}-{random}.{ext}`
- 支持的格式：JPEG、PNG、GIF、WebP
- 文件大小限制：10MB

## 安全特性

1. **用户认证**：上传和删除操作需要登录
2. **权限控制**：用户只能删除自己的照片
3. **文件验证**：限制文件类型和大小
4. **SQL 注入防护**：使用参数化查询
5. **XSS 防护**：前端对内容进行转义

## 注意事项

1. 确保服务器有足够的存储空间用于照片文件
2. 建议定期备份 `backend/uploads/photos/` 目录
3. 如果部署到生产环境，建议使用 CDN 或对象存储服务
4. 可以根据需要调整文件大小限制（在 `backend/routes/photos.js` 中）

## 未来优化建议

- [ ] 添加照片分类/标签功能
- [ ] 支持批量上传
- [ ] 添加照片编辑功能（裁剪、滤镜等）
- [ ] 实现照片点赞和评论功能
- [ ] 添加照片搜索功能
- [ ] 优化图片压缩和缩略图生成
- [ ] 支持相册权限设置（公开/私密）

